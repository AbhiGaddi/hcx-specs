openapi: 3.0.1
info:
  title: HCX Notification APIs
  description: >-
    The Health Claims Exchange (HCX) is a digital infrastructure designed to
    enable automated, data-driven management of health insurance claims in an
    open ecosystem. These API specifications enable all actors to consume, subscribe or unsubscribe and send notifications in the ecosystem.
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'
  version: 0.7.0
externalDocs:
  description: HCX Specifications
  url: >-
    https://docs.swasth.app/hcx-specifications/
tags:
  - name: Notification APIs
    description: >-
      APIs for notification subscription management and send and receive the callback requests.
      
paths:
  /notification/topic/list:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for the participants in the network to check the master list of notifications available to them.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TopicListRequest'
      
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopicListResponse'
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []
  /notification/subscribe:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for the participants in the network to check the master list of notifications available and subscribe to them.


        The participant will be identified using the Auth Token from the API request headers.


        The participant should send the below details in the request body while making a call for notification subscription.
          1. The notification "topic_code" to understand the notification to which the participant want to subscribe.
          2. The participant list to which the subscription request should be sent for confirmation.
        
        The response to this API could be one of the following:
          1. A  successful OK (200) response from the HCX gateway if the strucuture of the request is valid. There is no callback expected in this case.
          2. An error response if any of the validations fail.
        
        If the request is validated and accepted by HCX gateway, it will be forward to the given sender list.

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionRequest'
                
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
                      subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: 1
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
                      subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: -1
                
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []
  /notification/on_subscribe:
    post:
      tags:
        - Notification APIs
      description: >- 
        The callback API is for the senders to respond for the subscription request.
      
      requestBody:
        content:
          application/json:
            schema:
              properties:
                subscription_id:
                  type: string
                  description: Unique identifier of the notification subscription.
                  example: "SUBSCRIPTION01@HCX01"
                subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: 1
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []
  /notification/unsubscribe:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for the participants in the network to check the subscription list and unsubscribe to them.
        
        

        The participant will be identified using the Auth Token from the API request headers.


        The participant should send the below details in the request body while making a call for notification subscription.
          1. The notification "topic_code" to understand the notification to which the participant want to unsubscribe.
          2. The participant list to which the unsubscription request should be sent for confirmation.
        
        The response to this API could be one of the following:
          1. A  successful OK (200) response from the HCX gateway if the strucuture of the request is valid. There is no callback expected in this case.
          2. An error response if any of the validations fail.
        
        If the request is validated and accepted by HCX gateway, it will be forward to the given sender list.
      
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
                      subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: 1
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []
  /notification/subscription/list:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for the participants to get the notification subscription list.
        The API will return all the notification subscription details with status.
        
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TopicListRequest'

      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionList'
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - bearer_auth: []

  /notification/subscription/update:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for only sender of the notification to update the existing subscription.
        In this case, the HCX gateway will capture the impacted participant and send an network notification about update in subscription to the targeted participants.
      
        This API is work in progress. We need to analyse and validate most of the possible scenarios and update the API accordingly.
      
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
                      subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: 1
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      subscription_id:
                        type: string
                        description: Unique identifier of the notification subscription.
                        example: "SUBSCRIPTION01@HCX01"
                      subscription_status:
                        type: number
                        description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
                        example: -1
                
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []      
      
  /notification/notify:
    post:
      tags:
        - Notification APIs
      description: >-
        This API is for the participants to explicitly send the notification to recipients via HCX gateway.
      
        The participant should send the below details in the request body while making a call to send notification.
          1. The subscriptions or recipient_roles or recipient_codes to whom the notification need to send.
          2. The notification details like topic_code, topic, and data to understand the notification to which the participant want to send the notification.
          
        
        The response to this API could be one of the following:
          1. A successful accepted (202) response from the HCX gateway if the strucuture of the request is valid and the validation of is successful. Upon successful validation, HCX gateway forwards the same request to the intended recipient asynchronously.
          3. An error response if any of the validations fail.
          
        The HCX gateway will send the notification to all the recipients of the notification if it is a network notification.

      requestBody:
        content:
          application/json:
            schema:
                $ref: '#/components/schemas/NotifyRequest'
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      notification_id:
                        type: string
                        description: Unique identifer of the notification. This will be useful to check the status of notify.
        '400':
          description: Request Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Requested resource was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Downstream systems down/unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - bearer_auth: []

components:
  schemas:
    TopicListRequest:
      type: object
      description: JSON object explaining about the request filters, limits of the notification list.
      properties:
        filters:
          type: object
          description: Filters to apply and get the required notification master list
        limit:
          type: number
          description: Max number of notification master list to return in the response.
          example: 10
        offset:
          type: number
    TopicListResponse:
      type: object
      description: The notification master list response object.
      properties:
        timestamp:
          type: string
          description: Unix timestamp when the response is sent.
          example: "1629057611000"
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/NotificationTopic'
        count:
          type: number
          description: Total number of master list notifications defined at HCX gateway with the given request filter.
          example: 1
    SubscriptionRequest:
      type: object
      required:
        - topic_code
        - sender_list
      properties:
        topic_code:
          type: string
          description: Unique notification identifier from HCX gateway using the master list.
          example: "NOTIFICATION@HCX01"
        sender_list:
          type: array
          description: The list of sender to which the subscription request will be sent to approve or reject.
          items:
            type: string
            example: "PAYOR01@HCX01"
    NotifyRequest:
      type: object
      properties:
        topic_code:
          type: string
          description: Unique notification identifier from HCX gateway using the master list.
          example: "NOTIFICATION@HCX01"
        topic:
          type: string
          description: Topic of notification as defined in the master list of notifications.
        recipient_codes:
          type: array
          items:
            type: string
          description: Participant code of the recipient(s) of the notification. Could be one or more based on the need.
        recipient_roles:
          type: array
          items:
            type: string
          description: Participant role of the recipient(s) of the notification. Could be one or more based on the need. recipient_codes and/or recipientRoles can be used to send a notification (network or participant category) to a subset of participants defined in the notification master data for the corresponding topic.
        subscriptions:
          type: array
          items:
            type: string
          description: list of subscription_ids (at least one) is mandatory for workflow category notifications.
        notification_data:
          type: object
          description: JSON object containing the details of the notification to send.
          example: {"message": "Payor system down for sometime","duration": 2hrs,"startTime": 9PM, "date": 26th April 2022 IST}

    NotificationTopic:
      type: object
      properties:
        title:
          type: string
          description: The title of the notification
          example: "Payer Downtime"
        description:
          type: string
          description: The details about the notification.
          example: "A notification about the Payer System Downtime. This information will be useful for all participants."
        allowed_senders:
          type: array
          description: List of roles who can send this notification.
          items:
            type: string
          example: ["payor"]
        allowed_reciepients:
          type: array
          description: List of roles who can subscribe to this notification.
          items:
            type: string
          example: ["provider"]
        topic_code:
          type: string
          description: Unique code for the notification topic
          example: "NOTIFICATION@HCX01"
        category:
          type: string
          description: Category of the notification as detailed above - network, participant, workflow
          enum: ["network", "participant", "workflow"]
          example: network
        priority:
          type: number
          description: Default priority assigned to the topic. 0 means highest, positive integer would carry the respective relative priority. Negative would be that the topic is disabled. Relative order of category for different message categories is recommended to be workflow > participant > network
          enum: [-1,0,1,2]
    Subscription:
      type: object
      allOf:
        - properties:
            subscription_id:
              type: string
              description: Unique identifier of the notification subscription.
              example: "SUBSCRIPTION01@HCX01"
            subscription_status:
              type: number
              description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
              example: 1
            topic_code:
              type: string
              description: Unique code for the notification topic
              example: "NOTIFICATION@HCX01"
            category:
              type: string
              description: Category of the notification as detailed above - network, participant, workflow
              enum: ["network", "participant", "workflow"]
              example: network
            recipient_code:
              type: string
              description: Identifier of the subscriber.
            sender_code:
              type: string
              description: Identifier of the participant to who the notification subscription is made or quested for.
            is_delegated:
              type: boolean
              description: This property will be used to delegate the notification trigger to HCX. The default value is false.
              enum: [true, false]
              example: false
    SubscriptionList:
      type: object
      description: The notification subscription list response object.
      properties:
        timestamp:
          type: string
          description: Unix timestamp when the response is sent.
          example: "1629057611000"
        subscriptions:
          type: array
          items:
            $ref: '#/components/schemas/Subscription'
        count:
          type: number
          description: Total number of master list notifications defined at HCX gateway with the given request filter.
          example: 1
    SubscriptionUpdate:
      type: object
      allOf:
        - properties:
            subscription_status:
              type: number
              description: Status of the subscription. 1 - active, 0 - inactive, -1 - pending for approval.
              example: 1
            topic_code:
              type: string
              description: Unique code for the notification topic
              example: "NOTIFICATION@HCX01"
            recipient_code:
              type: string
              description: Identifier of the subscriber.
            sender_code:
              type: string
              description: Identifier of the participant to who the notification subscription is made or quested for.
            is_delegated:
              type: boolean
              description: This property will be used to delegate the notification trigger to HCX. The default value is false.
              enum: [true, false]
              example: false
    ErrorResponse:
      required:
        - error
        - timestamp
      type: object
      properties:
        timestamp:
          type: string
          description: Unix timestamp when the response is sent.
          example: "1629057611000"
        error:
          $ref: '#/components/schemas/Error'
    SuccessResponse:
      required:
        - timestamp
      type: object
      properties:
        timestamp:
          type: string
          description: Unix timestamp when the response is sent.
          example: "1629057611000"
    Error:
      type: object
      properties:
        code:
          type: string
          description: error code from the system - expected to be namespaced for better readability
          enum:
            - ERR_ACCESS_DENIED
            - ERR_INVALID_PAYLOAD
            - ERR_INVALID_SENDER
            - ERR_INVALID_RECIPIENT
            - ERR_INVALID_TOPIC_CODE
            - ERR_INVALID_NOTIFICATION_DATA
            - ERR_INVALID_SUBSCRIPTION
            - ERR_INVALID_RECIPIENT_ROLES
            - ERR_SERVICE_UNAVAILABLE 
        message:
          type: string
          description: Short description of the error
        trace:
          type: string
          description: Long description supporting the Code

  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      
